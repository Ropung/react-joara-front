(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[962],{6930:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/books/[bid]/episode/[eid]/comment",function(){return s(4710)}])},4710:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return I}});var n=s(5893),r=s(7294),l=s(1163),a=s(9352),i=s(9583);let o=e=>new Date(e).toLocaleString();var c=s(6991),u=s(8742),d=s(5945),h=s(8228);let m=(e,t,s,n)=>u.Vm.put("books/".concat(e,"/episode/").concat(t,"/comment/").concat(s,"}"),n).then(e=>{let{data:t}=e}).catch(console.error),x=()=>{let e=(0,d.NL)();return(0,h.D)(e=>{let{bookId:t,episodeId:s,commentId:n,reqData:r}=e;return m(t,s,n,r)},{onError:e=>alert(e),onSuccess:()=>{e.invalidateQueries([c.hY])}})},f=(e,t,s)=>u.Vm.delete("books/".concat(e,"/episode/").concat(t,"/comment/").concat(s,"}")).then(e=>{let{data:t}=e}).catch(console.error),p=()=>{let e=(0,d.NL)();return(0,h.D)(e=>{let{bookId:t,episodeId:s,commentId:n}=e;return f(t,s,n)},{onError:e=>alert(e),onSuccess:()=>{e.invalidateQueries([c.hY])}})};var b=s(3750);let v=e=>{let{replyList:t}=e;(0,l.useRouter)();let[s,i]=(0,r.useState)(""),[c,u]=(0,r.useState)(!1),d=(0,r.useRef)(null),{mutate:h}=p(),{mutate:m}=p(),x=e=>{"Enter"===e.code&&f()},f=async()=>{u(!c)},v=async e=>{};return(0,n.jsx)("ul",{className:"w-full p-4",children:null==t?void 0:t.map(e=>{var t;return(0,n.jsxs)("li",{className:"flex flex-row w-full gap-2 p-8 border-t",children:[(0,n.jsx)("div",{className:"flex flex-row items-center flex-1 gap-4",children:(0,n.jsxs)("figcaption",{className:"flex flex-row items-center w-full gap-2",children:[(0,n.jsx)(b.oqf,{className:"rotate-180"}),(0,n.jsx)("p",{className:"text-lg font-semibold text-main whitespace-nowrap",children:e.nickname}),c?(0,n.jsx)("textarea",{className:"w-full p-2 border rounded-md focus:outline-none focus:border-main",defaultValue:e.content,ref:d,onChange:e=>i(e.target.value),onKeyDown:x}):(0,n.jsx)("p",{className:"w-full p-2 pr-4",children:e.content})]})}),(0,n.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,n.jsx)("small",{className:"text-sm text-gray-400",children:o(null!==(t=e.createdAt)&&void 0!==t?t:"")}),(0,n.jsx)("button",{className:"flex items-center justify-center text-2xl text-main",onClick:f,children:(0,n.jsx)(a.v0Y,{})}),(0,n.jsx)("button",{className:"flex items-center justify-center text-2xl text-red-400",onClick:v,children:(0,n.jsx)(a.Ehm,{})})]})]},"reply-".concat(e.id))})})};var j=s(8193),N=s(7848);let g=async(e,t,s,n,r)=>{let{data:l}=await u._i.get("/books/".concat(e,"/episode/").concat(t,"/comment/").concat(s,"/reply"));return l},w=(e,t,s,n,r)=>(0,N.a)({queryKey:[c.hY],queryFn:()=>g(e,t,s,null!=n?n:5,null!=r?r:1)}),y=e=>{let{content:t,createdAt:s,deletedAt:c,epiId:u,commentId:d,memberId:h,nickname:m,status:f,updatedAt:b}=e,[N,g]=(0,r.useState)(null!=t?t:""),[y,R]=(0,r.useState)(!1),[k,E]=(0,r.useState)(!1),[S,C]=(0,r.useState)({}),M=(0,l.useRouter)(),{bid:O,eid:I}=M.query,{data:{replyList:_,lastPage:L}={}}=w(Number(O),I,null!=d?d:""),V=(0,r.useRef)(null),q=(0,r.useRef)(null),A=e=>{"Enter"===e.code&&Q()},{mutate:D}=x(),{mutate:Y}=p(),K=e=>{var t,s;let n=null===(t=e.target)||void 0===t?void 0:t.value,r=null===(s=e.target)||void 0===s?void 0:s.id;C(e=>({...e,[r]:n}))},T=async()=>{if(!O||!I||!S)throw Error("내용이 비었거나 잘못된 요청입니다.")},Q=async()=>{if(!O||!u||!d||!N)throw Error("내용이 비었거나 잘못된 요청입니다.");R(!y),y&&D({bookId:Number(O),episodeId:u,commentId:d,reqData:N},{onSuccess:()=>{},onError:e=>{alert(e)}})},U=async e=>{if(!O||!I||!d)throw Error("잘못된 요청입니다.");confirm("정말로 삭제 하시겠습니까?")&&Y({bookId:Number(O),episodeId:null!=u?u:"",commentId:null!=d?d:""},{onSuccess:()=>{},onError:e=>{alert(e)}})};return(0,n.jsx)("li",{className:"border-t",children:(0,n.jsx)("div",{className:"flex justify-between p-2",children:(0,n.jsxs)("div",{className:"flex flex-col w-full gap-4",children:[(0,n.jsxs)("figure",{className:"flex justify-between w-full",children:[(0,n.jsxs)("div",{className:"flex flex-row items-center gap-4",children:[(0,n.jsx)("div",{className:"w-[50px] h-[50px] rounded-full overflow-hidden flex justify-center items-center bg-gray-300 shadow-lg p-[1px] mr-4",children:(0,n.jsx)(i.m3W,{className:"text-[120px] text-white"})}),(0,n.jsx)("figcaption",{className:"flex flex-row items-center gap-2",children:(0,n.jsx)("p",{className:"text-lg font-semibold text-main",children:m})})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("small",{className:"text-sm text-gray-400",children:o(null!=s?s:"")}),(0,n.jsx)("button",{className:"flex items-center justify-center text-2xl text-main",onClick:Q,children:(0,n.jsx)(a.v0Y,{})}),(0,n.jsx)("button",{className:"flex items-center justify-center text-2xl text-red-400",onClick:U,children:(0,n.jsx)(a.Ehm,{})})]})]}),y?(0,n.jsx)("textarea",{className:"w-full p-2 border rounded-md focus:outline-none focus:border-main",defaultValue:N,ref:q,onChange:e=>g(e.target.value),onKeyDown:A}):(0,n.jsx)("p",{className:"p-2 pr-4",children:N}),(0,n.jsx)("div",{className:"flex items-center justify-end",children:(0,n.jsxs)("p",{className:"flex flex-row items-center gap-2 cursor-pointer",onClick:()=>{E(!k)},children:[(0,n.jsx)("span",{children:" 답글달기"}),(0,n.jsx)(j.Vs3,{className:"duration-200 ".concat(k&&"rotate-180")})]})}),k?(0,n.jsxs)("div",{className:"min-h-[70px] flex justify-between gap-2",children:[(0,n.jsx)("textarea",{id:"content",className:"flex-auto w-full px-2 py-1 text-sm border rounded-sm focus:outline-none focus:border-main rounded-l-md",ref:V,placeholder:"댓글을 입력해주세요.",onChange:e=>{K(e)}}),(0,n.jsx)("button",{className:"basis-[120px] shrink-0 border-black rounded-xl bg-main/50 hover:bg-main font-bold",onClick:T,children:"대댓글 쓰기"})]}):(0,n.jsx)("br",{}),(0,n.jsx)(v,{replyList:_})]})})},"comment-".concat(d))},R=(e,t,s)=>u._i.post("/books/".concat(e,"/episode/").concat(t,"/comment"),s).then(e=>{let{data:t}=e}).catch(console.error),k=()=>{let e=(0,d.NL)();return(0,h.D)(e=>{let{bookId:t,episodeId:s,commentValue:n}=e;return R(t,s,n)},{onError:e=>alert(e),onSuccess:()=>{e.invalidateQueries([c.hY])}})};var E=s(8929);let S=async(e,t,s,n)=>{let{data:r}=await u._i.get("/books/".concat(e,"/episode/").concat(t,"/comment"));return r},C=(e,t,s,n)=>(0,N.a)({queryKey:[c.hY,e,t,s,n],queryFn:()=>S(e,t,s,n)}),M=()=>{var e;let t=(0,l.useRouter)(),{bid:s,eid:a}=t.query,i=(0,r.useRef)(null),{data:{commentList:o,lastPage:c}={}}=C(Number(s),a,E.$u.TWENTY,1),[u,d]=(0,r.useState)({}),h=e=>{var t,s;let n=null===(t=e.target)||void 0===t?void 0:t.value,r=null===(s=e.target)||void 0===s?void 0:s.id;d(e=>({...e,[r]:n}))},{mutate:m}=k(),x=async()=>{if(!s||!a||!u)throw Error("내용이 비었거나 잘못된 요청입니다.");m({bookId:Number(s),episodeId:a,commentValue:u},{onSuccess:()=>{i.current&&(i.current.value="")},onError:e=>{alert(e)}})};return(0,n.jsxs)("section",{className:"flex flex-col w-full gap-4",children:[(0,n.jsxs)("h1",{children:["댓글",(0,n.jsxs)("span",{className:"font-bold text-main",children:["(",null!==(e=null==o?void 0:o.length)&&void 0!==e?e:0,")"]})]}),(0,n.jsxs)("div",{className:"min-h-[70px] flex justify-between gap-2",children:[(0,n.jsx)("textarea",{id:"content",className:"flex-auto w-full px-2 py-1 text-sm border rounded-sm focus:outline-none focus:border-main rounded-l-md",ref:i,placeholder:"댓글을 입력해주세요.",onChange:e=>{h(e)}}),(0,n.jsx)("button",{className:"basis-[120px] shrink-0 border-black rounded-xl bg-main/50 hover:bg-main font-bold",onClick:x,children:"댓글 쓰기"})]}),(0,n.jsx)("ul",{className:"flex flex-col w-full gap-4",children:null==o?void 0:o.map(e=>(0,n.jsx)(y,{commentId:e.id,epiId:e.epiId,memberId:e.memberId,nickname:e.nickname,content:e.content,status:e.status,createdAt:e.createdAt,updatedAt:e.updatedAt,deletedAt:e.deletedAt},"commentId".concat(e.id)))})]})},O=()=>(0,n.jsx)("div",{className:"flex items-center justify-center w-full p-8",children:(0,n.jsx)("section",{className:"w-[90%] flex flex-col gap-4 bg-white rounded-md p-8 shadow-md",children:(0,n.jsx)(M,{})})});var I=O},8228:function(e,t,s){"use strict";s.d(t,{D:function(){return h}});var n=s(7294),r=s(464),l=s(2161),a=s(9886),i=s(81),o=s(3989);class c extends o.l{constructor(e,t){super(),this.client=e,this.setOptions(t),this.bindMethods(),this.updateResult()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){var t;let s=this.options;this.options=this.client.defaultMutationOptions(e),(0,l.VS)(s,this.options)||this.client.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.currentMutation,observer:this}),null==(t=this.currentMutation)||t.setOptions(this.options)}onUnsubscribe(){if(!this.listeners.length){var e;null==(e=this.currentMutation)||e.removeObserver(this)}}onMutationUpdate(e){this.updateResult();let t={listeners:!0};"success"===e.type?t.onSuccess=!0:"error"===e.type&&(t.onError=!0),this.notify(t)}getCurrentResult(){return this.currentResult}reset(){this.currentMutation=void 0,this.updateResult(),this.notify({listeners:!0})}mutate(e,t){return this.mutateOptions=t,this.currentMutation&&this.currentMutation.removeObserver(this),this.currentMutation=this.client.getMutationCache().build(this.client,{...this.options,variables:void 0!==e?e:this.options.variables}),this.currentMutation.addObserver(this),this.currentMutation.execute()}updateResult(){let e=this.currentMutation?this.currentMutation.state:(0,a.R)(),t={...e,isLoading:"loading"===e.status,isSuccess:"success"===e.status,isError:"error"===e.status,isIdle:"idle"===e.status,mutate:this.mutate,reset:this.reset};this.currentResult=t}notify(e){i.V.batch(()=>{if(this.mutateOptions&&this.hasListeners()){var t,s,n,r,l,a,i,o;e.onSuccess?(null==(t=(s=this.mutateOptions).onSuccess)||t.call(s,this.currentResult.data,this.currentResult.variables,this.currentResult.context),null==(n=(r=this.mutateOptions).onSettled)||n.call(r,this.currentResult.data,null,this.currentResult.variables,this.currentResult.context)):e.onError&&(null==(l=(a=this.mutateOptions).onError)||l.call(a,this.currentResult.error,this.currentResult.variables,this.currentResult.context),null==(i=(o=this.mutateOptions).onSettled)||i.call(o,void 0,this.currentResult.error,this.currentResult.variables,this.currentResult.context))}e.listeners&&this.listeners.forEach(e=>{e(this.currentResult)})})}}var u=s(5945),d=s(4798);function h(e,t,s){let a=(0,l.lV)(e,t,s),o=(0,u.NL)({context:a.context}),[h]=n.useState(()=>new c(o,a));n.useEffect(()=>{h.setOptions(a)},[h,a]);let x=(0,r.$)(n.useCallback(e=>h.subscribe(i.V.batchCalls(e)),[h]),()=>h.getCurrentResult(),()=>h.getCurrentResult()),f=n.useCallback((e,t)=>{h.mutate(e,t).catch(m)},[h]);if(x.error&&(0,d.L)(h.options.useErrorBoundary,[x.error]))throw x.error;return{...x,mutate:f,mutateAsync:x.mutate}}function m(){}}},function(e){e.O(0,[937,445,774,888,179],function(){return e(e.s=6930)}),_N_E=e.O()}]);